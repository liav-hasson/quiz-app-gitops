# Jenkins Platform Configuration
# Resources for Jenkins agents running on EKS cluster
# Provides: namespace, RBAC, BuildKit, and Docker registry credentials

# Jenkins agent configuration
jenkins:
  enabled: true
  namespace: jenkins
  serviceAccountName: jenkins
  clusterRoleBindingName: jenkins-cluster-admin
  
  # Static token for Jenkins controller (EC2) to authenticate with EKS
  # Jenkins controller uses this token to create pods for builds
  serviceAccountToken:
    enabled: true
    secretName: jenkins-token

# BuildKit daemon for Docker builds (replaces Docker-in-Docker)
buildkit:
  enabled: true
  namespace: jenkins
  image: moby/buildkit:v0.12.0
  port: 1234
  
  # Resource limits for BuildKit daemon
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 2000m
      memory: 4Gi
  
  # Docker config secret for private registry authentication
  dockerConfigSecretName: docker-config

# External Secrets Operator integration
# Fetches Docker Hub credentials from AWS SSM Parameter Store
# Uses cluster-level ClusterSecretStore (created by quiz-app ArgoCD application)
externalSecrets:
  enabled: true
  namespace: jenkins
  
  # ClusterSecretStore configuration (cluster-scoped, not namespaced)
  secretStore:
    name: aws-parameter-store  # References the ClusterSecretStore
  
  # Docker registry credentials from SSM
  # SSM Parameter: /weatherlabs/app/docker-registry-config
  # Format: {"auths":{"https://index.docker.io/v1/":{"username":"liavvv","password":"dckr_pat_..."}}}
  dockerRegistry:
    enabled: true
    secretName: docker-config
    ssmParameterPath: /weatherlabs/app/docker-registry-config

# Docker registries used:
# 1. Jenkins agent image: liavvv/jenkins-agent
# 2. Quiz app builds: liavvv/quiz-app
